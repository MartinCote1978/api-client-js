"use strict";(function(){function t(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],e=null,n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(r){}return e}function e(t){var e={};if(t)return e;for(var n=t.split("\r\n"),r=0;r<n.length;r++){var o=n[r],u=o.indexOf(": ");if(u>-1){var s=o.substring(0,u),i=o.substring(u+2);e[s]=i}}return e}function n(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}var r=function(r,o,u){var s=this;if(!r)throw new Error("URL required!");if(!u)throw new Error("Transport required(http or sockjs)!");if("undefined"==typeof Promise)throw new Error("Promise implementation required!");if("sockjs"==u&&"undefined"==typeof SockJS)throw new Error("Sockjs transport is required but not available!");s.url=r,s.apiToken=o,s.transport=u;var i={},c={},a=null,f=0,l=!1,d=1,p=1e4,h=null,y=function(){a.send(JSON.stringify({type:"subscribe",token:s.authToken}))},b=function j(){return new Promise(function(t,e){console.debug("sockjs: connecting, timeout",p),a=new SockJS(r+"/ws"),f=0,c={};var n=setTimeout(function(){e(new Error("timeout"))},p);a.onopen=function(){Object.keys(i).length>0&&y(),l=!0,d=1,n&&(clearTimeout(n),n=null),console.debug("sockjs: connected"),t()},a.onmessage=function(t){n&&(clearTimeout(n),n=null);var e=JSON.parse(t.data);switch(e.type){case"response":c[e.id]&&c[e.id](e);break;default:if(i[e.type]){var r=!0,o=!1,u=void 0;try{for(var s,a=i[e.type][Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var f=s.value;f(e)}}catch(l){o=!0,u=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw u}}}}},a.onclose=function(){console.debug("sockjs: it's dead Jim :()",h);var t=!0,e=!1,r=void 0;try{for(var o,u=Object.keys(c)[Symbol.iterator]();!(t=(o=u.next()).done);t=!0){var s=o.value;console.debug("sockjs: reject handler with id",s),c[s]({status:598,body:JSON.stringify({message:"Disconnected from SockJS endpoint"})})}}catch(i){e=!0,r=i}finally{try{!t&&u["return"]&&u["return"]()}finally{if(e)throw r}}c={},a=null,l=!1,n&&(clearTimeout(n),n=null),h&&h(),d=16>d?2*d:1;var f=1e3*d;setTimeout(j,f),console.debug("sockjs: reconnect scheduled after ",f)}})},g=function(n,o,u,i){return i||(i={}),i.headers||(i.headers={}),("POST"===n.toUpperCase()||"PUT"===n.toUpperCase())&&(i.headers["Content-Type"]="application/json;charset=utf-8"),s.authToken&&(i.headers.Authorization="Bearer "+s.authToken),s.apiToken&&(i.headers["X-Lavaboom-Token"]=s.apiToken),n=n.toUpperCase(),new Promise("sockjs"==s.transport?a?function(t,e){f++;var r=f.toString(),s=JSON.stringify({id:r,type:"request",method:n,path:o,body:JSON.stringify(u),headers:i.headers});console.debug("sockjs: sending a message",s),a.send(s),c[r]=function(n){n.body=JSON.parse(n.body),n.status>=200&&n.status<300?t(n):e(n)}}:function(t,e){e({status:597,body:JSON.stringify({message:"No connection to SockJS endpoint"})})}:function(s,c){var a=t();if(!a)return c(new Error("Ajax isn't supported!"));a.open(n,r+o,!0),a.onreadystatechange=function(){if(4===a.readyState){var t=void 0;try{t=JSON.parse(a.responseText)}catch(n){t=n}a.status>=200&&a.status<300?s({body:t,status:a.status,headers:e(a.getAllResponseHeaders())}):c({body:t,status:a.status,headers:e(a.getAllResponseHeaders())})}};var f=!0,l=!1,d=void 0;try{for(var p,h=Object.keys(i.headers)[Symbol.iterator]();!(f=(p=h.next()).done);f=!0){var y=p.value;a.setRequestHeader(y,i.headers[y])}}catch(b){l=!0,d=b}finally{try{!f&&h["return"]&&h["return"]()}finally{if(l)throw d}}a.send(JSON.stringify(u))})},k=function(){if(!a)throw new Error("Not using SockJS");if(!l)throw new Error("Must be connected");if(!s.authToken)throw new Error("Not authenticated")},m=function(t,e,r){return e&&Object.keys(e).length>0&&(t+="?"+n(e)),g("GET",t,null,r)},v=function(t,e,n){return g("POST",t,e,n)},w=function(t,e,n){return g("PUT",t,e,n)},S=function(t,e,r){return e&&Object.keys(e).length>0&&(t+="?"+n(e)),g("DELETE",t,null,r)};s.connect=function(t){return new Promise(function(e,n){return t||(t={}),t.timeout?p=t.timeout:t.timeout=p,h=t.onDisconnect?t.onDisconnect:null,l||"sockjs"!=s.transport?e():void b(t).then(function(t){return e(t)})["catch"](function(t){return n(t)})})},s.isConnected=function(){return l},s.subscribe=function(t,e){k(),Object.keys(i).length<1&&y(),i[t]||(i[t]=[]),i[t].push(e)},s.unSubscribe=function(t,e){if(k(),!i[t])throw new Error("Subscription not found");throw i[t]=i[t].filter(function(t){return t!=e}),new Error("Subscription not found")},s.info=function(){return m("/")},s.addresses={get:function(){return m("/addresses")}},s.accounts={create:{register:function(t){return v("/accounts",t)},verify:function(t){return v("/accounts",t)},setup:function(t){return v("/accounts",t)}},get:function(t){return m("/accounts/"+t)},update:function(t,e){return w("/accounts/"+t,e)},"delete":function(t){return S("/accounts/"+t)},wipeData:function(t){return v("/accounts/"+t+"/wipe-data")},startOnboarding:function(t){return v("/accounts/"+t+"/start-onboarding")}},s.files={list:function(t){return m("/files",t)},create:function(t){return v("/files",t)},get:function(t){return m("/files/"+t)},update:function(t,e){return w("/files/"+t,e)},"delete":function(t){return S("/files/"+t)}},s.contacts={list:function(){return m("/contacts")},create:function(t){return v("/contacts",t)},get:function(t){return m("/contacts/"+t)},update:function(t,e){return w("/contacts/"+t,e)},"delete":function(t){return S("/contacts/"+t)}},s.emails={list:function(t){return m("/emails",t)},get:function(t){return m("/emails/"+t)},create:function(t){return v("/emails",t)},"delete":function(t){return S("/emails/"+t)}},s.keys={list:function(t){return m("/keys?user="+t)},get:function(t){return m("/keys/"+encodeURIComponent(t))},create:function(t){return v("/keys",{key:t})}},s.labels={list:function(){return m("/labels")},get:function(t){return m("/labels/"+t)},create:function(t){return v("/labels",t)},"delete":function(t){return S("/labels/"+t)},update:function(t,e){return w("/labels/"+t,e)}},s.threads={list:function(t){return m("/threads",t)},get:function(t){return m("/threads/"+t)},update:function(t,e){return w("/threads/"+t,e)},"delete":function(t){return S("/threads/"+t)}},s.tokens={getCurrent:function(){return m("/tokens")},get:function(t){return m("/tokens/"+t)},create:function(t){return v("/tokens",t)},deleteCurrent:function(){return S("/tokens")},"delete":function(t){return S("/tokens/"+t)}}},o={};r.getInstance=function(t,e,n){var u=""+t+"."+n;return o[u]||(o[u]=new r(t,e,n)),o[u]},this.Lavaboom=r}).call(window);
//# sourceMappingURL=lavaboom-api.min.js.map