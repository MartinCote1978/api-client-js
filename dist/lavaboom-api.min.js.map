{"version":3,"sources":["lavaboom-api.js","lavaboom-api.min.js"],"names":["getAjaxRequest","XMLHttpRequest","versions","xhr","i","length","ActiveXObject","error","parseResponseHeaders","input","headers","pairs","split","pair","index","indexOf","key","substring","val","encodeQueryData","data","Object","keys","map","k","encodeURIComponent","join","Lavaboom","url","apiToken","transport","self","this","Error","Promise","SockJS","subscriptions","handlers","sockjs","sockjs–°ounter","isConnected","rc","defaultTimeout","onDisconnectHandler","subscribe","send","JSON","stringify","type","token","authToken","connect","resolve","reject","console","debug","connectionTimeout","setTimeout","onopen","clearTimeout","onmessage","e","msg","parse","id","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","subscription","value","err","onclose","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","status","body","message","timeout","request","method","path","options","toUpperCase","Authorization","toString","req","open","onreadystatechange","readyState","responseText","getAllResponseHeaders","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","setRequestHeader","checkSubscribe","invokeGet","invokePost","invokePut","invokeDelete","opts","onDisconnect","then","r","name","callback","push","unSubscribe","filter","s","info","addresses","get","accounts","create","register","query","verify","setup","who","update","what","delete","wipeData","startOnboarding","files","list","contacts","emails","labels","threads","tokens","getCurrent","deleteCurrent","instances","getInstance","call","window"],"mappings":"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","file":"lavaboom-api.min.js","sourcesContent":["/* jshint esnext: true */\r\n/* global ActiveXObject */\r\n/* global SockJS */\r\n\r\n(function() {\r\n\t/* Helper functions */\r\n\tfunction getAjaxRequest() {\r\n\t\tif (typeof XMLHttpRequest !== 'undefined') {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t}\r\n\r\n\t\tlet versions = [\r\n\t\t\t'MSXML2.XmlHttp.5.0',\r\n\t\t\t'MSXML2.XmlHttp.4.0',\r\n\t\t\t'MSXML2.XmlHttp.3.0',\r\n\t\t\t'MSXML2.XmlHttp.2.0',\r\n\t\t\t'Microsoft.XmlHttp'\r\n\t\t];\r\n\r\n\t\tlet xhr = null;\r\n\t\tfor (let i = 0; i < versions.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\txhr = new ActiveXObject(versions[i]);\r\n\t\t\t\tbreak;\r\n\t\t\t} catch (error) { }\r\n\t\t}\r\n\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction parseResponseHeaders(input) {\r\n\t\tlet headers = {};\r\n\r\n\t\tif (input) {\r\n\t\t\treturn headers;\r\n\t\t}\r\n\r\n\t\tlet pairs = input.split('\\r\\n');\r\n\r\n\t\tfor (let i = 0; i < pairs.length; i++) {\r\n\t\t\tlet pair = pairs[i];\r\n\r\n\t\t\t// Does same thing as strings.SplitN in Go\r\n\t\t\tlet index = pair.indexOf(': ');\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tlet key = pair.substring(0, index);\r\n\t\t\t\tlet val = pair.substring(index + 2);\r\n\t\t\t\theaders[key] = val;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn headers;\r\n\t}\r\n\r\n\tfunction encodeQueryData(data) {\r\n\t\treturn Object.keys(data).map(k =>\r\n\t\t\tencodeURIComponent(k) + '=' + encodeURIComponent(data[k])\r\n\t\t).join('&');\r\n\t}\r\n\r\n\t/* API client class */\r\n\r\n\tlet Lavaboom = function(url, apiToken, transport) {\r\n\t\tlet self = this;\r\n\r\n\t\tif (!url)\r\n\t\t\tthrow new Error('URL required!');\r\n\r\n\t\tif (!transport)\r\n\t\t\tthrow new Error('Transport required(http or sockjs)!');\r\n\r\n\t\tif (typeof Promise === 'undefined')\r\n\t\t\tthrow new Error('Promise implementation required!');\r\n\r\n\t\tif (transport == 'sockjs' && typeof SockJS === 'undefined')\r\n\t\t\tthrow new Error('Sockjs transport is required but not available!');\r\n\r\n\t\tself.url = url;\r\n\t\tself.apiToken = apiToken;\r\n\t\tself.transport = transport;\r\n\r\n\t\tlet subscriptions = {};\r\n\t\tlet handlers = {};\r\n\t\tlet sockjs = null;\r\n\t\tlet sockjs–°ounter = 0;\r\n\t\t\r\n\t\tlet isConnected = false;\r\n\t\tlet rc = 1;\r\n\r\n\t\tlet defaultTimeout = 10000;\r\n\t\tlet onDisconnectHandler = null;\r\n\r\n\t\tconst subscribe = () => {\r\n\t\t\tsockjs.send(JSON.stringify({\r\n\t\t\t\ttype: 'subscribe',\r\n\t\t\t\ttoken: self.authToken\r\n\t\t\t}));\t\r\n\t\t};\r\n\t\t\r\n\t\tconst connect = () => new Promise((resolve, reject) => {\r\n\t\t\tconsole.debug('sockjs: connecting, timeout', defaultTimeout);\r\n\r\n\t\t\tsockjs = new SockJS(url + '/ws');\r\n\t\t\tsockjs–°ounter = 0;\r\n\t\t\thandlers = {};\r\n\r\n\t\t\tlet connectionTimeout = setTimeout(() => {\r\n\t\t\t\treject(new Error('timeout'));\r\n\t\t\t}, defaultTimeout);\r\n\r\n\t\t\tsockjs.onopen = function () {\r\n\t\t\t\tif (Object.keys(subscriptions).length > 0)\r\n\t\t\t\t\tsubscribe();\r\n\t\t\t\t\r\n\t\t\t\tisConnected = true;\r\n\t\t\t\trc = 1;\r\n\r\n\t\t\t\tif (connectionTimeout) {\r\n\t\t\t\t\tclearTimeout(connectionTimeout);\r\n\t\t\t\t\tconnectionTimeout = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.debug('sockjs: connected');\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\r\n\t\t\tsockjs.onmessage = (e) => {\r\n\t\t\t\tif (connectionTimeout) {\r\n\t\t\t\t\tclearTimeout(connectionTimeout);\r\n\t\t\t\t\tconnectionTimeout = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet msg = JSON.parse(e.data);\r\n\r\n\t\t\t\tswitch (msg.type) {\r\n\t\t\t\t\tcase 'response':\r\n\t\t\t\t\t\tif (handlers[msg.id])\r\n\t\t\t\t\t\t\thandlers[msg.id](msg);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (subscriptions[msg.type]) {\r\n\t\t\t\t\t\t\tfor (let subscription of subscriptions[msg.type])\r\n\t\t\t\t\t\t\t\tsubscription(msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tsockjs.onclose = () => {\r\n\t\t\t\tconsole.debug('sockjs: it\\'s dead Jim :()', onDisconnectHandler);\r\n\r\n\t\t\t\tfor (let id of Object.keys(handlers)) {\r\n\t\t\t\t\tconsole.debug('sockjs: reject handler with id', id);\r\n\t\t\t\t\thandlers[id]({\r\n\t\t\t\t\t\tstatus: 598,\r\n\t\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\t\tmessage: 'Disconnected from SockJS endpoint'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\thandlers = {};\r\n\t\t\t\tsockjs = null;\r\n\t\t\t\tisConnected = false;\r\n\r\n\t\t\t\tif (connectionTimeout) {\r\n\t\t\t\t\tclearTimeout(connectionTimeout);\r\n\t\t\t\t\tconnectionTimeout = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (onDisconnectHandler)\r\n\t\t\t\t\tonDisconnectHandler();\r\n\r\n\t\t\t\trc = rc < 16 ? rc * 2 : 1;\r\n\r\n\t\t\t\tlet timeout = rc * 1000;\r\n\t\t\t\tsetTimeout(connect, timeout);\r\n\r\n\t\t\t\tconsole.debug('sockjs: reconnect scheduled after ', timeout);\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tconst request = (method, path, data, options) => {\r\n\t\t\tif (!options)\r\n\t\t\t\toptions = {};\r\n\r\n\t\t\tif (!options.headers)\r\n\t\t\t\toptions.headers = {};\r\n\r\n\t\t\t// Add a Content-Type to the request if we're sending a body\r\n\t\t\tif (method.toUpperCase() === 'POST' || method.toUpperCase() === 'PUT')\r\n\t\t\t\toptions.headers['Content-Type'] = 'application/json;charset=utf-8';\r\n\r\n\t\t\tif (self.authToken)\r\n\t\t\t\toptions.headers.Authorization = 'Bearer ' + self.authToken;\r\n\r\n\t\t\tif (self.apiToken)\r\n\t\t\t\toptions.headers['X-Lavaboom-Token'] = self.apiToken;\r\n\r\n\t\t\tmethod = method.toUpperCase();\r\n\t\t\tif (self.transport == 'sockjs') {\r\n\t\t\t\tif (sockjs)\r\n\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tsockjs–°ounter++;\r\n\t\t\t\t\t\tlet id = sockjs–°ounter.toString();\r\n\r\n\t\t\t\t\t\tlet msg = JSON.stringify({\r\n\t\t\t\t\t\t\tid: id,\r\n\t\t\t\t\t\t\ttype: 'request',\r\n\t\t\t\t\t\t\tmethod: method,\r\n\t\t\t\t\t\t\tpath: path,\r\n\t\t\t\t\t\t\tbody: JSON.stringify(data),\r\n\t\t\t\t\t\t\theaders: options.headers\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconsole.debug('sockjs: sending a message', msg);\r\n\r\n\t\t\t\t\t\tsockjs.send(msg);\r\n\r\n\t\t\t\t\t\thandlers[id] = (data) => {\r\n\t\t\t\t\t\t\tdata.body = JSON.parse(data.body);\r\n\r\n\t\t\t\t\t\t\tif (data.status >= 200 && data.status < 300) {\r\n\t\t\t\t\t\t\t\tresolve(data);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treject(data);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\treject({\r\n\t\t\t\t\t\tstatus: 597,\r\n\t\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\t\tmessage: 'No connection to SockJS endpoint'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet req = getAjaxRequest();\r\n\r\n\t\t\t\tif (!req)\r\n\t\t\t\t\treturn reject(new Error('Ajax isn\\'t supported!'));\r\n\r\n\t\t\t\t// Start the request. Last param is whether it should be performed async or not\r\n\t\t\t\treq.open(method, url + path, true);\r\n\t\t\t\treq.onreadystatechange = () => {\r\n\t\t\t\t\t// 4 means complete\r\n\t\t\t\t\tif (req.readyState !== 4)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tlet body;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tbody = JSON.parse(req.responseText);\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tbody = error;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (req.status >= 200 && req.status < 300) {\r\n\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\tbody: body,\r\n\t\t\t\t\t\t\tstatus: req.status,\r\n\t\t\t\t\t\t\theaders: parseResponseHeaders(req.getAllResponseHeaders())\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject({\r\n\t\t\t\t\t\t\tbody: body,\r\n\t\t\t\t\t\t\tstatus: req.status,\r\n\t\t\t\t\t\t\theaders: parseResponseHeaders(req.getAllResponseHeaders())\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfor (let key of Object.keys(options.headers))\r\n\t\t\t\t\treq.setRequestHeader(key, options.headers[key]);\r\n\r\n\t\t\t\treq.send(JSON.stringify(data));\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tconst checkSubscribe = () => {\r\n\t\t\tif (!sockjs)\r\n\t\t\t\tthrow new Error('Not using SockJS');\r\n\r\n\t\t\tif (!isConnected)\r\n\t\t\t\tthrow new Error('Must be connected');\r\n\r\n\t\t\tif (!self.authToken)\r\n\t\t\t\tthrow new Error('Not authenticated');\r\n\t\t};\r\n\r\n\t\tconst invokeGet = (path, data, options) => {\r\n\t\t\tif (data && Object.keys(data).length > 0)\r\n\t\t\t\tpath += '?' + encodeQueryData(data);\r\n\r\n\t\t\treturn request('GET', path, null, options);\r\n\t\t};\r\n\r\n\t\tconst invokePost = (path, data, options) => {\r\n\t\t\treturn request('POST', path, data, options);\r\n\t\t};\r\n\r\n\t\tconst invokePut = (path, data, options) => {\r\n\t\t\treturn request('PUT', path, data, options);\r\n\t\t};\r\n\r\n\t\tconst invokeDelete = (path, data, options) => {\r\n\t\t\tif (data && Object.keys(data).length > 0)\r\n\t\t\t\tpath += '?' + encodeQueryData(data);\r\n\r\n\t\t\treturn request('DELETE', path, null, options);\r\n\t\t};\r\n\r\n\t\tself.connect = (opts) => new Promise((resolve, reject) => {\r\n\t\t\tif (!opts)\r\n\t\t\t\topts = {};\r\n\r\n\t\t\tif (!opts.timeout)\r\n\t\t\t\topts.timeout = defaultTimeout;\r\n\t\t\telse\r\n\t\t\t\tdefaultTimeout = opts.timeout;\r\n\t\t\tonDisconnectHandler = opts.onDisconnect ? opts.onDisconnect : null;\r\n\r\n\t\t\tif (isConnected || self.transport != 'sockjs')\r\n\t\t\t\treturn resolve();\r\n\r\n\t\t\tconnect(opts)\r\n\t\t\t\t.then(r => resolve(r))\r\n\t\t\t\t.catch(err => reject(err));\r\n\t\t});\r\n\r\n\t\tself.isConnected = () => isConnected;\r\n\r\n\t\tself.subscribe = (name, callback) => {\r\n\t\t\tcheckSubscribe();\r\n\r\n\t\t\tif (Object.keys(subscriptions).length < 1)\r\n\t\t\t\tsubscribe();\r\n\r\n\t\t\tif (!subscriptions[name])\r\n\t\t\t\tsubscriptions[name] = [];\r\n\t\t\tsubscriptions[name].push(callback);\r\n\t\t};\r\n\r\n\t\tself.unSubscribe = function(name, callback){\r\n\t\t\tcheckSubscribe();\r\n\r\n\t\t\tif (!subscriptions[name])\r\n\t\t\t\tthrow new Error('Subscription not found');\r\n\r\n\t\t\tsubscriptions[name] = subscriptions[name].filter(s => s != callback);\r\n\t\t\tthrow new Error('Subscription not found');\r\n\t\t};\r\n\r\n\t\tself.info = function() {\r\n\t\t\treturn invokeGet('/');\r\n\t\t};\r\n\r\n\t\tself.addresses = {\r\n\t\t\tget: () => invokeGet('/addresses')\r\n\t\t};\r\n\r\n\t\tself.accounts = {\r\n\t\t\tcreate: {\r\n\t\t\t\tregister: (query) => invokePost('/accounts', query),\r\n\t\t\t\tverify: (query) => invokePost('/accounts', query),\r\n\t\t\t\tsetup: (query) => invokePost('/accounts', query)\r\n\t\t\t},\r\n\t\t\tget: (who) => invokeGet('/accounts/' + who),\r\n\t\t\tupdate: (who, what) => invokePut('/accounts/' + who, what),\r\n\t\t\tdelete: (who) => invokeDelete('/accounts/' + who),\r\n\t\t\twipeData: (who) => invokePost('/accounts/' + who + '/wipe-data'),\r\n\t\t\tstartOnboarding: (who) => invokePost('/accounts/' + who + '/start-onboarding')\r\n\t\t};\r\n\r\n\t\tself.files = {\r\n\t\t\tlist: (query) => invokeGet('/files', query),\r\n\t\t\tcreate: (query) => invokePost('/files', query),\r\n\t\t\tget: (id) => invokeGet('/files/' + id),\r\n\t\t\tupdate: (id, query) => invokePut('/files/' + id, query),\r\n\t\t\tdelete: (id) => invokeDelete('/files/' + id)\r\n\t\t};\r\n\r\n\t\tself.contacts = {\r\n\t\t\tlist: () => invokeGet('/contacts'),\r\n\t\t\tcreate: (query) => invokePost('/contacts', query),\r\n\t\t\tget: (id) => invokeGet('/contacts/' + id),\r\n\t\t\tupdate: (id, query) => invokePut('/contacts/' + id, query),\r\n\t\t\tdelete: (id) => invokeDelete('/contacts/' + id)\r\n\t\t};\r\n\r\n\t\tself.emails = {\r\n\t\t\tlist: (query) => invokeGet('/emails', query),\r\n\t\t\tget: (id) => invokeGet('/emails/' + id),\r\n\t\t\tcreate: (query) => invokePost('/emails', query),\r\n\t\t\tdelete: (id) => invokeDelete('/emails/' + id)\r\n\t\t};\r\n\r\n\t\tself.keys = {\r\n\t\t\tlist: (name) => invokeGet('/keys?user=' + name),\r\n\t\t\tget: (id) => invokeGet('/keys/' + encodeURIComponent(id)),\r\n\t\t\tcreate: (key) => invokePost('/keys', {\r\n\t\t\t\tkey\r\n\t\t\t})\r\n\t\t};\r\n\r\n\t\tself.labels = {\r\n\t\t\tlist: () => invokeGet('/labels'),\r\n\t\t\tget: (id) => invokeGet('/labels/' + id),\r\n\t\t\tcreate: (query) => invokePost('/labels', query),\r\n\t\t\tdelete: (id) => invokeDelete('/labels/' + id),\r\n\t\t\tupdate: (id, query) => invokePut('/labels/' + id, query)\r\n\t\t};\r\n\r\n\t\tself.threads = {\r\n\t\t\tlist: (query) => invokeGet('/threads', query),\r\n\t\t\tget: (id) => invokeGet('/threads/' + id),\r\n\t\t\tupdate: (id, query) => invokePut('/threads/' + id, query),\r\n\t\t\tdelete: (id) => invokeDelete('/threads/' + id)\r\n\t\t};\r\n\r\n\t\tself.tokens = {\r\n\t\t\tgetCurrent: () => invokeGet('/tokens'),\r\n\t\t\tget: id => invokeGet('/tokens/' + id),\r\n\t\t\tcreate: query => invokePost('/tokens', query),\r\n\t\t\tdeleteCurrent: () => invokeDelete('/tokens'),\r\n\t\t\tdelete: id => invokeDelete('/tokens/' + id)\r\n\t\t};\r\n\t};\r\n\r\n\tlet instances = {};\r\n\r\n\tLavaboom.getInstance = (url, apiToken, transport) => {\r\n\t\tlet key = `${url}.${transport}`;\r\n\t\tif (!instances[key])\r\n\t\t\tinstances[key] = new Lavaboom(url, apiToken, transport);\r\n\t\treturn instances[key];\r\n\t};\r\n\r\n\tthis.Lavaboom = Lavaboom;\r\n}).call(window);",null],"sourceRoot":"/source/"}